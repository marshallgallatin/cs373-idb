{% extends "layout.html" %}
{% block scripts %}
	<style>
	td {
		padding-left: 5px
	}
	.img-responsive {
		max-height: 300px
	}
	.panel-code {
		font-family: Menlo, Monaco, Consolas, "Courier New" , monospace;
		background-color: #f9f2f4;
		text-align: left;
		white-space: pre;
		overflow: scroll;
	}
	</style>

	<script src="https://d3js.org/d3.v3.min.js" charset="utf-8"></script>
	<script>
		angular.module('mbApp', []).controller('mbCtrl', function($scope, $http) {
			$scope.getData = function() {
				var data = '{{ data }}'
				console.log(data)
				$scope.data = '{{ data }}'
			}
			$scope.D3 = function() {
				var w = 900,
					h = 400;

				var circleWidth = 5;

				var colors = d3.scale.category20c(); // d3 utility function, colors

				var nodes = [
					{name: "Parent"},
					{name: "child1"},
					{name: "child2", target: [0]},
					{name: "child3", target: [0]},
					{name: "child4", target: [1]},
					{name: "child5", target: [0, 1, 2, 3]}
				]

				// source, target
				var links = [];
				for (var i = 0; i < nodes.length; i++)
				{
					// check that the node we're working with has targets
					// if the target exists
					if (nodes[i].target !== undefined)
					{
						for (var x = 0; x < nodes[i].target.length; x++)
						{
							links.push({
								source: nodes[i],
								target: nodes[nodes[i].target[x]]
							})
						}
					}
				}

				var myChart = d3.select('#chart')
					.append('svg')
						.attr('width', w)
						.attr('height', h)

				// force layout
				var force = d3.layout.force()
					.nodes(nodes)
					.links([])
					.gravity(0.3)
					.charge(-1000)
					.size([w, h])

				var link = myChart.selectAll('line')
					.data(links)
					.enter().append('line')
					.attr('stroke', 'black')

				var node = myChart.selectAll('circle')
					.data(nodes)
					.enter()
					.append('g')
					.call(force.drag)

				// changes every node in the graphic
				node.append('circle')
					.attr('cx', function(d) {
						return d.x;
					})
					.attr('cy', function(d) {
						return d.y;
					})
					.attr('r', circleWidth)
					.attr('fill', colors[1])

				node.append('text')
					.text(function(d) {return d.name})
					.attr('font-family', 'Robot Slab')
					.attr('text-anchor', 'beginning')
					.attr('fill', function(d, i) {
						if (i > 0) { return "black"; } // if child
						else { return "blue"; }
					})
					.attr('font-size', function(d, i) {
						if (i == 0) { return '1.8em'; } // if parent
						return '1em';
					})

				force.on('tick', function(e) { // 'tick' is javascript's time passing
					node.attr('transform', function(d, i) {
						return 'translate(' + d.x + ',' + d.y + ')';
					})

					link
						.attr('x1', function(d) {
							return d.source.x;
						})
						.attr('y1', function(d) {
							return d.source.y;
						})
						.attr('x2', function(d) {
							return d.target.x;
						})
						.attr('y2', function(d) {
							return d.target.y;
						})
				})


				force.start();
			}

			$(function() {
				$scope.getData();
				$scope.D3();
			});
		}); // end angular.module(...)
	</script>
{% endblock scripts %}

{% block title %}
{{ title }}
{% endblock title %}

{% block content %}
<h1>Sweet Music Page </h1>
<div ng-app="mbApp" ng-controller="mbCtrl">
	<div class="row"> 
		<div class="col-xs-12 col-sm-6 col-lg-6">
			<div ng-repeat="x in data">
				<br /> {{ data }}
			</div>
		</div>
	</div>
	<div class="container">
		<h2> D3 </h2>
	<div id="chart"></div>
</div>
</div>
{% endblock content %}

